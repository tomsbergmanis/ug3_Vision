<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/Documents/IVR/as1/ug3_Vision/report/src/code.m.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#808080"><font face="monospace">
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: main.m %%%%%%%</b></font></span><br>
<font color="#000000">function</font>&nbsp;res = main(path, image_type, start_offset, time_step)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = <font color="#ff40ff"><b>'jpg'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_offset = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>4</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_step = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.33</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;_path = mfilename(<font color="#ff40ff"><b>'fullpath'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>_path, _, _<font color="#000000">]</font>&nbsp;= fileparts(_path)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;addpath(fullfile(_path, <font color="#ff40ff"><b>'algo'</b></font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;addpath(fullfile(_path, <font color="#ff40ff"><b>'draw'</b></font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;addpath(fullfile(_path, <font color="#ff40ff"><b>'test'</b></font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;files = dir(sprintf(<font color="#ff40ff"><b>'%s/*.%s'</b></font>, path, image_type))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filenames = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, num_files<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(filenames)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>m n <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>})))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;track_mask = <font color="#0000ff">zeros</font>(m, n)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;rc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;gc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;reds = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;greens = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blues = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;i = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;start_offset : num_files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{i}))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>directions, centroids<font color="#000000">]</font>&nbsp;= analyse_image(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc(i,:) = <font color="#000000">[</font>r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>, g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gc(i,:) = <font color="#000000">[</font>g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bc(i,:) = <font color="#000000">[</font>b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reds{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;greens{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blues{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imshow(overlay_mask(image, directions))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pause(time_step)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;rc = rc(any(rc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;gc = gc(any(gc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bc = bc(any(bc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;red_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, reds{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, greens{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, blues{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;bg = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_median, green_median, blue_median)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, rc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, gc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, bc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_mask(bg, track_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;imshow(bg)<br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: analyse_image.m %%%%%%%</b></font></span><br>
<font color="#000000">function</font>&nbsp;<font color="#000000">[</font>pretty_mask, varargout<font color="#000000">]</font>&nbsp;= analyse_image(image)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blob_mask = mask_colors(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= mask_convex_regions(image, blob_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask<font color="#000000">]</font>=demask_triangles(image, convex_mask, false)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= mask_convex_regions(image, convex_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, centroids, <font color="#0000ff">~</font>, triangle_centroids<font color="#000000">]</font>&nbsp;= <font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;demask_triangles(image, convex_mask, true)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;pretty_mask = overlay_rays(<font color="#0000ff">zeros</font>(num_rows,num_cols,num_channels),<font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroids,triangle_centroids, <span style="background-color: #ffffff"><font color="#ff6060"><b>99</b></font></span>, <font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ff40ff"><b>'Color'</b></font>, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>} = triangle_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>} = convex_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this function can used to find both - triangles and masks without</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% triangles. To find triangles it must be run with</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% get_triangle_centroids=true. Also application of the function int the</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% following fashion gives better results. </b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask, ~] = mask_convex_regions(image, blob_mask);</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask]=demask_triangles(image, convex_mask, false);</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask, ~] = mask_convex_regions(image, convex_mask);</b></font></span><br>
<font color="#000000">function</font>&nbsp;<font color="#000000">[</font>mask, varargout<font color="#000000">]</font>&nbsp;= demask_triangles(image, mask, <font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_triangle_centroids)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;centroids = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;triangle_centroids&nbsp;&nbsp;= <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;trinagle_mask = mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_mask = mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask =&nbsp;&nbsp;mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel_mask)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rgb_values = <font color="#0000ff">zeros</font>(<font color="#0000ff">sum</font>(channel_mask(:)), <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;nr = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rows<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;nc = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_cols<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel_mask(nr, nc) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rgb_values(idx) = channel(nr, nc)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = idx <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mean_rgb = <font color="#0000ff">mean</font>(rgb_values(:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_mask(channel <font color="#0000ff">&lt;</font>&nbsp;mean_rgb) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask(:,:,c) = channel_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel_mask, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroid = props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroids(c,:) = <font color="#000000">[</font>centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;get_triangle_centroids<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask(channel <font color="#0000ff">&gt;</font>&nbsp;mean_rgb) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask=filter_mask(channel_trinagle_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trinagle_mask(:,:,c) = channel_trinagle_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel_trinagle_mask, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroid = props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangle_centroids(c,:) = <font color="#000000">[</font>centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>} = trinagle_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>} = triangle_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<font color="#000000">function</font>&nbsp;<font color="#000000">[</font>color_mask, varargout<font color="#000000">]</font>&nbsp;= mask_convex_regions(image, mask)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;color_mask = <font color="#0000ff">zeros</font>(num_rows, num_cols, num_channels)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;convex_centroids = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel, <font color="#ff40ff"><b>'Centroid'</b></font>, <font color="#ff40ff"><b>'ConvexImage'</b></font>, <font color="#ff40ff"><b>'BoundingBox'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_props = regionprops(props.ConvexImage, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroid = convex_props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroid = <font color="#000000">[</font>convex_centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), <font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convex_centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroids(c,:) = convex_centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_image = props.ConvexImage<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows_convex, num_cols_convex<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(convex_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;row = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rows_convex<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;col = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_cols_convex<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;convex_image(row, col) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newrow = <font color="#0000ff">round</font>(row <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newcol = <font color="#0000ff">round</font>(col <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color_mask(newrow, newcol, c) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = convex_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<font color="#000000">function</font>&nbsp;image_mask = mask_colors(image)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;num_pixels = num_rows <font color="#0000ff">*</font>&nbsp;num_cols<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image_mask = <font color="#0000ff">zeros</font>(num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;rgb = double(<font color="#0000ff">reshape</font>(image, num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;rgbN = double(<font color="#0000ff">reshape</font>(normalise_rgb(image, <font color="#ff40ff"><b>'approximate'</b></font>), num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;rN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;gN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;rN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;gN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;bN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;hsv = <font color="#0000ff">reshape</font>(rgb2hsv(image), num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hue = hsv(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>360</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is red</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>330</b></font></span>&nbsp;<font color="#0000ff">||</font>&nbsp;hue <font color="#0000ff">&lt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>30</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(rN, rN_mean, rN_sdev) <font color="#0000ff">&lt;</font>&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.001</b></font></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is green</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>80</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;hue <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>180</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(gN, gN_mean, gN_sdev) <font color="#0000ff">&lt;</font>&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.007</b></font></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is blue</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>150</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;hue <font color="#0000ff">&lt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>270</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(bN, bN_mean, bN_sdev) <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.0000085</b></font></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;image_mask = <font color="#0000ff">reshape</font>(image_mask, num_rows, num_cols, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image_mask = remove_noise(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image_mask = remove_outliers(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image_mask = enforce_similar_channel_areas(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<font color="#000000">function</font>&nbsp;x = normal_prob(val, mu, sigma)<br>
&nbsp;&nbsp;&nbsp;&nbsp;x = <span style="background-color: #ffffff"><font color="#ff6060"><b>1.0</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(sigma <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">sqrt</font>(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;pi)) <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">exp</font>(<font color="#0000ff">-</font>(val <font color="#0000ff">-</font>&nbsp;mu) <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;sigma <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<font color="#000000">function</font>&nbsp;image = remove_noise(image)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = bwmorph(channel, <font color="#ff40ff"><b>'majority'</b></font>, Inf)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = bwmorph(channel, <font color="#ff40ff"><b>'bridge'</b></font>, Inf)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% finds the connected components in each channel of |image| and removes those</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% that are far away from the centroid of the pixels in that channel</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% here, 'far away' means more distant than |distance_proprtion_threshold| times</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% the average distance of each connected component to the channel centroid</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this removes big areas of noise such as the big green blob inside of the black</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% arrow of the red robot in data/1/00000006.jpg</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = remove_outliers(image, distance_proportion_threshold)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distance_proportion_threshold = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.5</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_properties = regionprops(channel, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_centroid = channel_properties.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions = bwconncomp(channel)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions_properties = regionprops(regions, <font color="#ff40ff"><b>'Centroid'</b></font>, <font color="#ff40ff"><b>'PixelIdxList'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions_centroids = {regions_properties.Centroid}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distances = cellfun(@(x) norm(x <font color="#0000ff">-</font>&nbsp;channel_centroid), regions_centroids)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mean_distance = <font color="#0000ff">mean</font>(distances)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;d = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(distances)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;distances(d) <font color="#0000ff">&gt;</font>&nbsp;mean_distance <font color="#0000ff">*</font>&nbsp;distance_proportion_threshold<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = regions_properties(d).PixelIdxList<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(idx) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% we know that the robots are all about the same size - we can thus remove any</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% channels in the mask that have a much smaller area than the other channels</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this catches some problems like the shadow of the blue robot in </b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% data/1/00000095.jpg being detected as a red blob</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = enforce_similar_channel_areas(image, area_proportion_threshold)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;area_proportion_threshold = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.5</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;areas = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_props = regionprops(channel, <font color="#ff40ff"><b>'Area'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;areas(c) = region_props.Area<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;max_area = <font color="#0000ff">max</font>(areas(areas <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;area = areas(c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;area <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;&nbsp;(area <font color="#0000ff">&lt;</font>&nbsp;max_area <font color="#0000ff">*</font>&nbsp;area_proportion_threshold) <font color="#0000ff">||</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(area <font color="#0000ff">&gt;</font>&nbsp;max_area <font color="#0000ff">/</font>&nbsp;area_proportion_threshold)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = image(:,:,c) <font color="#0000ff">*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this filters out all conneceted regions but the biggest one</b></font></span><br>
<font color="#000000">function</font>&nbsp;mask = filter_mask(mask)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>x, y, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">zeros</font>(x, y)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">reshape</font>(channel, x <font color="#0000ff">*</font>&nbsp;y, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob_info = bwconncomp(mask(:,:,c))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob_list = blob_info.PixelIdxList<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>nrows, ncols<font color="#000000">]</font>&nbsp;= cellfun(@<font color="#0000ff">size</font>, blob_list)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;largest_blob_pixels = blob_list{find(nrows <font color="#0000ff">==</font>&nbsp;<font color="#0000ff">max</font>(nrows))}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;i = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: <font color="#0000ff">max</font>(nrows)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(largest_blob_pixels(i)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">reshape</font>(channel, x, y)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% normalises the values of the red, green, and blue channels of |image| in order</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% to eliminate illumination differences in the image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% formula used: {r, g, b} = {r, g, b} / sqrt(r^2 + g^2 + b^2)</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% if 'approximate' is passed as an additional parameter, instead use</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% {r, g, b} = {r, g, b} / (r + g + b) </b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this is approximately two times faster than the exact normalisation</b></font></span><br>
<font color="#000000">function</font>&nbsp;normalised_image = normalise_rgb(image, varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;approximate = <font color="#0000ff">~</font>isempty(find(strcmpi(varargin, <font color="#ff40ff"><b>'approximate'</b></font>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;red = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;approximate<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = red(:,:) <font color="#0000ff">+</font>&nbsp;green(:,:) <font color="#0000ff">+</font>&nbsp;blue(:,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = <font color="#0000ff">sqrt</font>(red(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;green(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;blue(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm = <font color="#0000ff">round</font>(red(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm = <font color="#0000ff">round</font>(green(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = <font color="#0000ff">round</font>(blue(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% some pixels are absolute black (r = g = b = 0) which causes division by</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% zero errors during normalisation and NaN values in the normalised channels</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% need to filter these values out</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm(isnan(red_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm(isnan(green_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm(isnan(blue_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm = uint8(red_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm = uint8(green_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = uint8(blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;normalised_image = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_norm, green_norm, blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: analyse_image.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: median_filter.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% generates a background image from a set of sample images</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% subtracting the background from the sample images eases object detection</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% does not work on these datasets because the blue/cyan robot does not move</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% for most of the images i.e. will be considered part of the background</b></font></span><br>
<font color="#000000">function</font>&nbsp;background = median_filter(path, image_type, start_offset, step)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = <font color="#ff40ff"><b>'jpg'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_offset = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;dim = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;files = dir(sprintf(<font color="#ff40ff"><b>'%s/*.%s'</b></font>, path, image_type))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filenames = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, num_files<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(filenames)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;reds = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;greens = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blues = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;start_offset :step: num_files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{c}))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reds{c} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;greens{c} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blues{c} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_median = median(cat(dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, reds{:}), dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_median = median(cat(dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, greens{:}), dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_median = median(cat(dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, blues{:}), dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;background = cat(dim <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, red_median, green_median, blue_median)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: median_filter.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: normalise_rgb.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% normalises the values of the red, green, and blue channels of |image| in order</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% to eliminate illumination differences in the image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% formula used: {r, g, b} = {r, g, b} / sqrt(r^2 + g^2 + b^2)</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% if 'approximate' is passed as an additional parameter, instead use</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% {r, g, b} = {r, g, b} / (r + g + b) </b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% this is approximately two times faster than the exact normalisation</b></font></span><br>
<font color="#000000">function</font>&nbsp;normalised_image = normalise_rgb(image, varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;approximate = <font color="#0000ff">~</font>isempty(find(strcmpi(varargin, <font color="#ff40ff"><b>'approximate'</b></font>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;red = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;approximate<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = red(:,:) <font color="#0000ff">+</font>&nbsp;green(:,:) <font color="#0000ff">+</font>&nbsp;blue(:,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = <font color="#0000ff">sqrt</font>(red(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;green(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;blue(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm = <font color="#0000ff">round</font>(red(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm = <font color="#0000ff">round</font>(green(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = <font color="#0000ff">round</font>(blue(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% some pixels are absolute black (r = g = b = 0) which causes division by</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% zero errors during normalisation and NaN values in the normalised channels</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% need to filter these values out</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm(isnan(red_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm(isnan(green_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm(isnan(blue_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;red_norm = uint8(red_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;green_norm = uint8(green_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = uint8(blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;normalised_image = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_norm, green_norm, blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: normalise_rgb.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: overlay_circles.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% draws the circles defined by the centres in |centers| and radiuses in |radii|</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% onto |image| and returns the modified image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% [0, 0] is the top left corner of the image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% if |radii| is a number, draw all circles with that radius</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = overlay_circles(image, centers, radii, varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;argc = <font color="#0000ff">size</font>(varargin, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Color'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Color option should be followed by an integer tripplet'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% option defaults</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'colors'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;num_circles = <font color="#0000ff">size</font>(centers, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">size</font>(radii, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radii = repmat(radii, num_circles, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">size</font>(colors, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = repmat(colors, num_circles, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;centers = <font color="#0000ff">round</font>(centers)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;radii = <font color="#0000ff">round</font>(radii)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = overlay_circles_channel(channel, centers, radii, colors(:,c))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<font color="#000000">function</font>&nbsp;channel = overlay_circles_channel(channel, centers, radii, colors)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>xmax, ymax<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(channel)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;num_circles = <font color="#0000ff">size</font>(centers, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_circles<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xc = centers(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yc = centers(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radius = radii(c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;theta = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;: <span style="background-color: #ffffff"><font color="#ff6060"><b>0.1</b></font></span>&nbsp;: <span style="background-color: #ffffff"><font color="#ff6060"><b>359</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = <font color="#0000ff">round</font>(Xc <font color="#0000ff">+</font>&nbsp;radius <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">cos</font>(theta))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y = <font color="#0000ff">round</font>(Yc <font color="#0000ff">+</font>&nbsp;radius <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">sin</font>(theta))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x <font color="#0000ff">&lt;=</font>&nbsp;xmax <font color="#0000ff">&amp;&amp;</font>&nbsp;x <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;y <font color="#0000ff">&lt;=</font>&nbsp;ymax <font color="#0000ff">&amp;&amp;</font>&nbsp;y <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(x, y) = colors(c,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: overlay_circles.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: overlay_cross.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns image with a cross centered on pixel (|x|, |y|) drawn in |channel|</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% [0, 0] is the top left corner of the image</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = overlay_cross(image, channel, x, y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>h w <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&lt;</font>&nbsp;h <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&lt;</font>&nbsp;w<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font>&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff">end</font><br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: overlay_cross.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: overlay_mask.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns the result of putting |mask| onto |image|</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% for each pixel that is set in some channel of |mask|, saturates the pixel in</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% the equivalent channel of |image|</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = overlay_mask(image, mask, varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;argc = <font color="#0000ff">size</font>(varargin, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'GrayScale'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grayscale = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Saturation'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Saturation option should be followed by a double'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saturation = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Lightness'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Lightness option should be followed by a double'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lightness = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% modify background image</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'grayscale'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gray_image = rgb2gray(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, gray_image, gray_image, gray_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'saturation'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image = rgb2hsv(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) = hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">*</font>&nbsp;saturation<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = hsv2rgb(hsv_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'lightness'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image = rgb2hsv(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) = hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) <font color="#0000ff">*</font>&nbsp;lightness<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = hsv2rgb(hsv_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% lay mask onto background image</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;num_channels = <font color="#0000ff">size</font>(image, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;channels = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask_pixels = find(mask(:,:,c) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(mask_pixels) = <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;d = setdiff(channels, c)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,d)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(mask_pixels) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,d) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: overlay_mask.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: overlay_polygon.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns image with lines drawn from the nth point in |points| to the n+1th</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% [0, 0] is the top left corner of the image</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = overlay_polygon(image, points, color)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color = <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;points = <font color="#0000ff">round</font>(points)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;num_channels = <font color="#0000ff">size</font>(image, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = overlay_polygon_channel(channel, points, color(c))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% Bresenham's line algorithm (simplified version)</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% <a href="http://en.wikipedia.org/wiki/Bresenham">http://en.wikipedia.org/wiki/Bresenham</a>'s_line_algorithm#Simplification</b></font></span><br>
<font color="#000000">function</font>&nbsp;channel = overlay_polygon_channel(channel, points, color)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>xmax, ymax<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(channel)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(points) <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start = points(c,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop = points(c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = start(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = start(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x1 = stop(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 = stop(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx = <font color="#0000ff">abs</font>(x1 <font color="#0000ff">-</font>&nbsp;x0)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dy = <font color="#0000ff">abs</font>(y1 <font color="#0000ff">-</font>&nbsp;y0)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">&lt;</font>&nbsp;x1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sx = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sx = <font color="#0000ff">-</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y0 <font color="#0000ff">&lt;</font>&nbsp;y1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sy = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sy = <font color="#0000ff">-</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = dx <font color="#0000ff">-</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;x0 <font color="#0000ff">&lt;=</font>&nbsp;xmax <font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">&lt;=</font>&nbsp;ymax<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(x0, y0) = color<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">==</font>&nbsp;x1 <font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">==</font>&nbsp;y1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">break</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;err<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;e2 <font color="#0000ff">&gt;</font>&nbsp;<font color="#0000ff">-</font>dy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = err <font color="#0000ff">-</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = x0 <font color="#0000ff">+</font>&nbsp;sx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;e2 <font color="#0000ff">&lt;</font>&nbsp;dx<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = err <font color="#0000ff">+</font>&nbsp;dx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = y0 <font color="#0000ff">+</font>&nbsp;sy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: overlay_polygon.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: overlay_rays.m %%%%%%%</b></font></span><br>
<font color="#000000">function</font>&nbsp;image = overlay_rays(image, from, to, length, varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;argc = <font color="#0000ff">size</font>(varargin, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Color'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Color option should be followed by an integer tripplet'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% option defaults</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'colors'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;num_rays = <font color="#0000ff">size</font>(from, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">size</font>(colors, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = repmat(colors, num_rays, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rays<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;from(c,:) <font color="#0000ff">==</font>&nbsp;to(c,:)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = from(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = from(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x1 = to(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 = to(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx = x0 <font color="#0000ff">-</font>&nbsp;x1<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dy = y0 <font color="#0000ff">-</font>&nbsp;y1<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lambda = <font color="#0000ff">min</font>(<font color="#0000ff">sqrt</font>(length <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(dx <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;dy <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)), <font color="#ff6060"><b>...</b></font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">-</font><font color="#0000ff">sqrt</font>(length <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(dx <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;dy <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = x0 <font color="#0000ff">+</font>&nbsp;lambda <font color="#0000ff">*</font>&nbsp;dx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y = y0 <font color="#0000ff">+</font>&nbsp;lambda <font color="#0000ff">*</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = overlay_polygon(image, <font color="#000000">[</font>x0 y0<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;x y<font color="#000000">]</font>, colors(c,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: overlay_rays.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: random_image.m %%%%%%%</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns a random image from some directory D and print the path to that image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% the function understands the following options:</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp; 'Quiet'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; don't print the path to the image</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp; 'ImageType', C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;look for images of type C (default = &quot;jpg&quot;)</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% any remaining parameters are taken to be the path to D</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% if D is not specified, default to a random sub-directory of &quot;ug3_Vision/data&quot;</b></font></span><br>
<font color="#000000">function</font>&nbsp;<font color="#000000">[</font>image, varargout<font color="#000000">]</font>&nbsp;= random_image(varargin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;TL_DIR = <font color="#ff40ff"><b>'ug3_Vision'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;BRANCH_DIR = <font color="#ff40ff"><b>'data'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;argc = length(varargin)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Quiet'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quiet = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'ImageType'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'ImageType option should be followed by a string'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path = arg<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% option defaults</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'quiet'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quiet = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'image_type'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = <font color="#ff40ff"><b>'.jpg'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'path'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path = random_dir(TL_DIR, BRANCH_DIR)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>strcmp(image_type(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), <font color="#ff40ff"><b>'.'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = strcat(<font color="#ff40ff"><b>'.'</b></font>, image_type)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;image_path = random_file(path, image_type)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;image = imread(image_path)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>quiet<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = strfind(image_path, TL_DIR)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;isempty(idx)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, <font color="#ff40ff"><b>'image = %s\n'</b></font>, image_path(idx : <font color="#0000ff">end</font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = image_path<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% looks for a directory |tl_dir| somewhere up from this file's location</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns the absolute path to one of the directories in |tl_dir|/|branch_dir|</b></font></span><br>
<font color="#000000">function</font>&nbsp;path = random_dir(tl_dir, branch_dir)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cur_path = mfilename(<font color="#ff40ff"><b>'fullpath'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;tl_path = cur_path(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: strfind(cur_path, tl_dir) <font color="#0000ff">+</font>&nbsp;length(tl_dir))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;branch_path = strcat(tl_path, branch_dir)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;branch_path_contents = dir(branch_path)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;branch_path_dirs = {}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(branch_path_contents)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elem = branch_path_contents(c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>elem.isdir <font color="#0000ff">||</font>&nbsp;strcmp(elem.name, <font color="#ff40ff"><b>'.'</b></font>) <font color="#0000ff">||</font>&nbsp;strcmp(elem.name, <font color="#ff40ff"><b>'..'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;branch_path_dirs{<font color="#0000ff">end</font>&nbsp;<font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = fullfile(branch_path, elem.name)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;path = branch_path_dirs{randi(<font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;length(branch_path_dirs)<font color="#000000">]</font>)}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>% returns a random file ending with |extension| found at |path|</b></font></span><br>
<font color="#000000">function</font>&nbsp;path = random_file(path, extension)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extension = <font color="#ff40ff"><b>''</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;file_type = strcat(<font color="#ff40ff"><b>'*'</b></font>, extension)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;files = dir(fullfile(path, file_type))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;filenames = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;path = fullfile(path, filenames{randi(<font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;length(filenames)<font color="#000000">]</font>)})<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: random_image.m %%%%%%%</b></font></span><br>
<br>
<br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% file: run_on_data.m %%%%%%%</b></font></span><br>
<font color="#0000ff">clear</font>&nbsp;all<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
clc<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'TL_DIR'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;TL_DIR = <font color="#ff40ff"><b>'ug3_Vision'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'IN_DIR'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;IN_DIR = <font color="#ff40ff"><b>'data'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'FILTER_FN'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;FILTER_FN = <font color="#ff40ff"><b>'analyse_image'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'OUT_DIR'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;OUT_DIR = fullfile(<font color="#ff40ff"><b>'res'</b></font>, strrep(FILTER_FN, <font color="#ff40ff"><b>'_'</b></font>, <font color="#ff40ff"><b>'-'</b></font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
filter_fn = str2func(FILTER_FN)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
disp(sprintf(<font color="#ff40ff"><b>'function: %s\ninput: %s\n'</b></font>, FILTER_FN, fullfile(TL_DIR, IN_DIR)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<br>
curpath = mfilename(<font color="#ff40ff"><b>'fullpath'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
tlpath = curpath(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: strfind(curpath, TL_DIR) <font color="#0000ff">+</font>&nbsp;length(TL_DIR))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
inpath = strcat(tlpath, IN_DIR)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
outpath = strcat(tlpath, OUT_DIR)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
inpath_contents = dir(inpath)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
inpath_dirs = {}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(inpath_contents)<br>
&nbsp;&nbsp;&nbsp;&nbsp;elem = inpath_contents(c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>elem.isdir <font color="#0000ff">||</font>&nbsp;strcmp(elem.name, <font color="#ff40ff"><b>'.'</b></font>) <font color="#0000ff">||</font>&nbsp;strcmp(elem.name, <font color="#ff40ff"><b>'..'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;inpath_dirs{<font color="#0000ff">end</font>&nbsp;<font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = fullfile(inpath, elem.name)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">end</font><br>
<br>
num_dirs = length(inpath_dirs)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
times = <font color="#000000">[]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_dirs<br>
&nbsp;&nbsp;&nbsp;&nbsp;in_dir = inpath_dirs{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;files = dir(strcat(in_dir, filesep, <font color="#ff40ff"><b>'*.jpg'</b></font>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;file_names = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;out_dir = fullfile(outpath, strcat(IN_DIR, <font color="#ff40ff"><b>'-'</b></font>, num2str(c)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(out_dir, <font color="#ff40ff"><b>'dir'</b></font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir(out_dir)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;num_files = length(file_names)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;d = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_name = file_names{d}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input = fullfile(in_dir, file_name)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disp(sprintf(<font color="#ff40ff"><b>'[dir %d/%d] [file %d/%d]'</b></font>, c, num_dirs, d, num_files))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disp(sprintf(<font color="#ff40ff"><b>'\tinput = %s'</b></font>, input(strfind(input, TL_DIR) : <font color="#0000ff">end</font>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = imread(input)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer = tic<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask = filter_fn(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elapsed = toc(timer)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;times(<font color="#0000ff">end</font>&nbsp;<font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) = elapsed<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output = fullfile(out_dir, file_name)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = overlay_mask(image, mask, <font color="#ff40ff"><b>'Saturation'</b></font>, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imwrite(image, output, <font color="#ff40ff"><b>'jpg'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disp(sprintf(<font color="#ff40ff"><b>'\toutput = %s'</b></font>, output(strfind(input, TL_DIR) : <font color="#0000ff">end</font>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disp(sprintf(<font color="#ff40ff"><b>'\tprocessing time = %fs'</b></font>, elapsed))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff">end</font><br>
<br>
disp(sprintf(<font color="#ff40ff"><b>'\naverage processing time per image: %fs'</b></font>, <font color="#0000ff">mean</font>(times)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<span style="background-color: #ffffff"><font color="#808080"><b>%%%%%%% end of file: run_on_data.m %%%%%%%</b></font></span><br>
</font></body>
</html>
