<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/Desktop/ug3_Vision/src/main.m.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#808080"><font face="monospace">
<font color="#0000ff"><b>&nbsp;1 </b></font><font color="#000000">function</font>&nbsp;res = main(path, image_type, start_offset, time_step)<br>
<font color="#0000ff"><b>&nbsp;2 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
<font color="#0000ff"><b>&nbsp;3 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = <font color="#ff40ff"><b>'jpg'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;4 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;5 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
<font color="#0000ff"><b>&nbsp;6 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_offset = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;7 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;8 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>4</b></font></span><br>
<font color="#0000ff"><b>&nbsp;9 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_step = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.33</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>10 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>11 </b></font><br>
<font color="#0000ff"><b>12 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;files = dir(sprintf(<font color="#ff40ff"><b>'%s/*.%s'</b></font>, path, image_type))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>13 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;filenames = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>14 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, num_files<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(filenames)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>15 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>16 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>m n <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>})))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>17 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;track_mask = <font color="#0000ff">zeros</font>(m, n)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>18 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>19 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>20 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>21 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>22 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>23 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;reds = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>24 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;greens = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>25 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blues = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>26 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
<font color="#0000ff"><b>27 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;i = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;start_offset : num_files<br>
<font color="#0000ff"><b>28 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{i}))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>29 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>directions, centroids<font color="#000000">]</font>&nbsp;= analyse_image(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>30 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
<font color="#0000ff"><b>31 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>32 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>33 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>34 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc(i,:) = <font color="#000000">[</font>r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>35 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>36 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>37 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>38 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>39 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>, g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>40 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gc(i,:) = <font color="#000000">[</font>g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>41 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>42 </b></font><br>
<font color="#0000ff"><b>43 </b></font>&nbsp;&nbsp;b = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>44 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>45 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>46 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bc(i,:) = <font color="#000000">[</font>b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>47 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>48 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>49 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reds{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>50 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;greens{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>51 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blues{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>52 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imshow(overlay_mask(image, directions))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>53 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>54 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pause(time_step)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>55 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>56 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>57 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rc = rc(any(rc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>58 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gc = gc(any(gc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>59 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bc = bc(any(bc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>60 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>61 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, reds{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>62 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, greens{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>63 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, blues{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>64 </b></font><br>
<font color="#0000ff"><b>65 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_median, green_median, blue_median)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>66 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>67 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, rc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>68 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, gc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>69 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, bc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>70 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_mask(bg, track_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>71 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;imshow(bg)<br>
<font color="#0000ff"><b>72 </b></font><font color="#0000ff">end</font><br>
</font></body>
</html>
