<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/Desktop/ug3_Vision/src/.all.m.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#808080"><font face="monospace">
<font color="#0000ff"><b>&nbsp;&nbsp;1 </b></font><font color="#000000">function</font>&nbsp;res = main(path, image_type, start_offset, time_step)<br>
<font color="#0000ff"><b>&nbsp;&nbsp;2 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
<font color="#0000ff"><b>&nbsp;&nbsp;3 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_type = <font color="#ff40ff"><b>'jpg'</b></font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;&nbsp;4 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;&nbsp;5 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
<font color="#0000ff"><b>&nbsp;&nbsp;6 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_offset = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;&nbsp;7 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;&nbsp;8 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>4</b></font></span><br>
<font color="#0000ff"><b>&nbsp;&nbsp;9 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_step = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.33</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;10 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;11 </b></font><br>
<font color="#0000ff"><b>&nbsp;12 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;files = dir(sprintf(<font color="#ff40ff"><b>'%s/*.%s'</b></font>, path, image_type))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;13 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;filenames = {files.name}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;14 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, num_files<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(filenames)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;15 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;16 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>m n <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>})))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;17 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;track_mask = <font color="#0000ff">zeros</font>(m, n)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;18 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;19 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;20 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;21 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bc = <font color="#0000ff">zeros</font>(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;22 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;23 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;reds = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;24 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;greens = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;25 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blues = cell(num_files <font color="#0000ff">-</font>&nbsp;start_offset, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;26 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
<font color="#0000ff"><b>&nbsp;27 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;i = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;start_offset : num_files<br>
<font color="#0000ff"><b>&nbsp;28 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = imread(sprintf(<font color="#ff40ff"><b>'%s/%s'</b></font>, path, filenames{i}))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;29 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>directions, centroids<font color="#000000">]</font>&nbsp;= analyse_image(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;30 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
<font color="#0000ff"><b>&nbsp;31 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;32 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>&nbsp;33 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;34 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc(i,:) = <font color="#000000">[</font>r(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), r(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;35 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;36 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;37 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;38 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>&nbsp;39 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>, g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;40 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gc(i,:) = <font color="#000000">[</font>g(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), g(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;41 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;42 </b></font><br>
<font color="#0000ff"><b>&nbsp;43 </b></font>&nbsp;&nbsp;b = uint16(centroids(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;44 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>&nbsp;45 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;track_mask = overlay_cross(track_mask, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;46 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bc(i,:) = <font color="#000000">[</font>b(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>), b(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;47 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;48 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;49 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reds{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;50 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;greens{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;51 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blues{i} = image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;52 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imshow(overlay_mask(image, directions))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;53 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;54 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pause(time_step)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;55 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;56 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;57 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rc = rc(any(rc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;58 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gc = gc(any(gc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;59 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bc = bc(any(bc,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>),:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;60 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;61 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, reds{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;62 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, greens{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;63 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue_median = median(cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, blues{:}), <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;64 </b></font><br>
<font color="#0000ff"><b>&nbsp;65 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_median, green_median, blue_median)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;66 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>&nbsp;67 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, rc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;68 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, gc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;69 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_polygon(bg, bc, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>, <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;70 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bg = overlay_mask(bg, track_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;71 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;imshow(bg)<br>
<font color="#0000ff"><b>&nbsp;72 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;73 </b></font><br>
<font color="#0000ff"><b>&nbsp;74 </b></font><br>
<font color="#0000ff"><b>&nbsp;75 </b></font><font color="#000000">function</font>&nbsp;<font color="#000000">[</font>pretty_mask, varargout<font color="#000000">]</font>&nbsp;= analyse_image(image)<br>
<font color="#0000ff"><b>&nbsp;76 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;77 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blob_mask = mask_colors(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;78 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= mask_convex_regions(image, blob_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;79 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask<font color="#000000">]</font>=demask_triangles(image, convex_mask, false)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;80 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>convex_mask, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= mask_convex_regions(image, convex_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;81 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, centroids, <font color="#0000ff">~</font>, triangle_centroids<font color="#000000">]</font>&nbsp;= <font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>&nbsp;82 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;demask_triangles(image, convex_mask, true)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;83 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;pretty_mask = overlay_rays(<font color="#0000ff">zeros</font>(num_rows,num_cols,num_channels),<font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>&nbsp;84 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroids,triangle_centroids, <span style="background-color: #ffffff"><font color="#ff6060"><b>99</b></font></span>, <font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>&nbsp;85 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ff40ff"><b>'Color'</b></font>, <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><font color="#000000">]</font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;86 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;87 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>} = triangle_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;88 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>} = convex_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>&nbsp;89 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>&nbsp;90 </b></font><br>
<font color="#0000ff"><b>&nbsp;91 </b></font><br>
<font color="#0000ff"><b>&nbsp;92 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% this function can used to find both - triangles and masks without</b></font></span><br>
<font color="#0000ff"><b>&nbsp;93 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% triangles. To find triangles it must be run with</b></font></span><br>
<font color="#0000ff"><b>&nbsp;94 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% get_triangle_centroids=true. Also application of the function int the</b></font></span><br>
<font color="#0000ff"><b>&nbsp;95 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% following fashion gives better results. </b></font></span><br>
<font color="#0000ff"><b>&nbsp;96 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask, ~] = mask_convex_regions(image, blob_mask);</b></font></span><br>
<font color="#0000ff"><b>&nbsp;97 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask]=demask_triangles(image, convex_mask, false);</b></font></span><br>
<font color="#0000ff"><b>&nbsp;98 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>%&nbsp;&nbsp;&nbsp;&nbsp;[convex_mask, ~] = mask_convex_regions(image, convex_mask);</b></font></span><br>
<font color="#0000ff"><b>&nbsp;99 </b></font><font color="#000000">function</font>&nbsp;<font color="#000000">[</font>mask, varargout<font color="#000000">]</font>&nbsp;= demask_triangles(image, mask, <font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>100 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_triangle_centroids)<br>
<font color="#0000ff"><b>101 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>102 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;centroids = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>103 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;triangle_centroids&nbsp;&nbsp;= <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>104 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;trinagle_mask = mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>105 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>106 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>107 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_mask = mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>108 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask =&nbsp;&nbsp;mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>109 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel_mask)<br>
<font color="#0000ff"><b>110 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>111 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>112 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rgb_values = <font color="#0000ff">zeros</font>(<font color="#0000ff">sum</font>(channel_mask(:)), <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>113 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>114 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;nr = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rows<br>
<font color="#0000ff"><b>115 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;nc = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_cols<br>
<font color="#0000ff"><b>116 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel_mask(nr, nc) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>117 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>118 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>119 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rgb_values(idx) = channel(nr, nc)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>120 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = idx <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>121 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>122 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>123 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mean_rgb = <font color="#0000ff">mean</font>(rgb_values(:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>124 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_mask(channel <font color="#0000ff">&lt;</font>&nbsp;mean_rgb) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>125 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask(:,:,c) = channel_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>126 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel_mask, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>127 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroid = props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>128 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroids(c,:) = <font color="#000000">[</font>centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>129 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;get_triangle_centroids<br>
<font color="#0000ff"><b>130 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask(channel <font color="#0000ff">&gt;</font>&nbsp;mean_rgb) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>131 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_trinagle_mask=filter_mask(channel_trinagle_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>132 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trinagle_mask(:,:,c) = channel_trinagle_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>133 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel_trinagle_mask, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>134 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;centroid = props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>135 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangle_centroids(c,:) = <font color="#000000">[</font>centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>136 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>137 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>138 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>139 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>} = trinagle_mask<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>140 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>} = triangle_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>141 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>142 </b></font><br>
<font color="#0000ff"><b>143 </b></font><br>
<font color="#0000ff"><b>144 </b></font><font color="#000000">function</font>&nbsp;<font color="#000000">[</font>color_mask, varargout<font color="#000000">]</font>&nbsp;= mask_convex_regions(image, mask)<br>
<font color="#0000ff"><b>145 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>146 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;color_mask = <font color="#0000ff">zeros</font>(num_rows, num_cols, num_channels)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>147 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;convex_centroids = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>148 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>149 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = mask(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>150 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
<font color="#0000ff"><b>151 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>152 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>153 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props = regionprops(channel, <font color="#ff40ff"><b>'Centroid'</b></font>, <font color="#ff40ff"><b>'ConvexImage'</b></font>, <font color="#ff40ff"><b>'BoundingBox'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>154 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_props = regionprops(props.ConvexImage, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>155 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroid = convex_props.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>156 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroid = <font color="#000000">[</font>convex_centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>), <font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>157 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; convex_centroid(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>158 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_centroids(c,:) = convex_centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>159 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convex_image = props.ConvexImage<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>160 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows_convex, num_cols_convex<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(convex_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>161 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;row = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rows_convex<br>
<font color="#0000ff"><b>162 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;col = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_cols_convex<br>
<font color="#0000ff"><b>163 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;convex_image(row, col) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
<font color="#0000ff"><b>164 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newrow = <font color="#0000ff">round</font>(row <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>165 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newcol = <font color="#0000ff">round</font>(col <font color="#0000ff">+</font>&nbsp;props.BoundingBox(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>166 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color_mask(newrow, newcol, c) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>167 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>168 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>169 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>170 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>171 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;varargout{<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>} = convex_centroids<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>172 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>173 </b></font><br>
<font color="#0000ff"><b>174 </b></font><br>
<font color="#0000ff"><b>175 </b></font><font color="#000000">function</font>&nbsp;image_mask = mask_colors(image)<br>
<font color="#0000ff"><b>176 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>num_rows, num_cols, <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>177 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;num_pixels = num_rows <font color="#0000ff">*</font>&nbsp;num_cols<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>178 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image_mask = <font color="#0000ff">zeros</font>(num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>179 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rgb = double(<font color="#0000ff">reshape</font>(image, num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>180 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rgbN = double(<font color="#0000ff">reshape</font>(normalise_rgb(image, <font color="#ff40ff"><b>'approximate'</b></font>), num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>181 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>182 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>183 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bN_sdev = <font color="#0000ff">std</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>184 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;rN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>185 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;gN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>186 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;bN_mean = <font color="#0000ff">mean</font>(rgbN(:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>187 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;hsv = <font color="#0000ff">reshape</font>(rgb2hsv(image), num_pixels, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>188 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_pixels<br>
<font color="#0000ff"><b>189 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>190 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>191 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bN = rgbN(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>192 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hue = hsv(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>360</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>193 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is red</b></font></span><br>
<font color="#0000ff"><b>194 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>330</b></font></span>&nbsp;<font color="#0000ff">||</font>&nbsp;hue <font color="#0000ff">&lt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>30</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>195 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(rN, rN_mean, rN_sdev) <font color="#0000ff">&lt;</font>&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.001</b></font></span>)<br>
<font color="#0000ff"><b>196 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>197 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is green</b></font></span><br>
<font color="#0000ff"><b>198 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>80</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;hue <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>180</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>199 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(gN, gN_mean, gN_sdev) <font color="#0000ff">&lt;</font>&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.007</b></font></span>)<br>
<font color="#0000ff"><b>200 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>201 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% current pixel is blue</b></font></span><br>
<font color="#0000ff"><b>202 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;&nbsp;(hue <font color="#0000ff">&gt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>150</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;hue <font color="#0000ff">&lt;=</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>270</b></font></span>) <font color="#0000ff">&amp;&amp;</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>203 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(normal_prob(bN, bN_mean, bN_sdev) <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0.0000085</b></font></span>)<br>
<font color="#0000ff"><b>204 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_mask(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>205 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>206 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>207 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image_mask = <font color="#0000ff">reshape</font>(image_mask, num_rows, num_cols, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>208 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image_mask = remove_noise(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>209 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image_mask = remove_outliers(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>210 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image_mask = enforce_similar_channel_areas(image_mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>211 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>212 </b></font><br>
<font color="#0000ff"><b>213 </b></font><br>
<font color="#0000ff"><b>214 </b></font><font color="#000000">function</font>&nbsp;x = normal_prob(val, mu, sigma)<br>
<font color="#0000ff"><b>215 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;x = <span style="background-color: #ffffff"><font color="#ff6060"><b>1.0</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(sigma <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">sqrt</font>(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;pi)) <font color="#0000ff">*</font>&nbsp;<font color="#0000ff">exp</font>(<font color="#0000ff">-</font>(val <font color="#0000ff">-</font>&nbsp;mu) <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;sigma <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>216 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>217 </b></font><br>
<font color="#0000ff"><b>218 </b></font><br>
<font color="#0000ff"><b>219 </b></font><font color="#000000">function</font>&nbsp;image = remove_noise(image)<br>
<font color="#0000ff"><b>220 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>221 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>222 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>223 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = bwmorph(channel, <font color="#ff40ff"><b>'majority'</b></font>, Inf)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>224 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = bwmorph(channel, <font color="#ff40ff"><b>'bridge'</b></font>, Inf)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>225 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>226 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>227 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>228 </b></font><br>
<font color="#0000ff"><b>229 </b></font><br>
<font color="#0000ff"><b>230 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% finds the connected components in each channel of |image| and removes those</b></font></span><br>
<font color="#0000ff"><b>231 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% that are far away from the centroid of the pixels in that channel</b></font></span><br>
<font color="#0000ff"><b>232 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% here, 'far away' means more distant than |distance_proprtion_threshold| times</b></font></span><br>
<font color="#0000ff"><b>233 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% the average distance of each connected component to the channel centroid</b></font></span><br>
<font color="#0000ff"><b>234 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% this removes big areas of noise such as the big green blob inside of the black</b></font></span><br>
<font color="#0000ff"><b>235 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% arrow of the red robot in data/1/00000006.jpg</b></font></span><br>
<font color="#0000ff"><b>236 </b></font><font color="#000000">function</font>&nbsp;image = remove_outliers(image, distance_proportion_threshold)<br>
<font color="#0000ff"><b>237 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
<font color="#0000ff"><b>238 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distance_proportion_threshold = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.5</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>239 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>240 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>241 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>242 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>243 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
<font color="#0000ff"><b>244 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>245 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>246 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_properties = regionprops(channel, <font color="#ff40ff"><b>'Centroid'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>247 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel_centroid = channel_properties.Centroid<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>248 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions = bwconncomp(channel)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>249 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions_properties = regionprops(regions, <font color="#ff40ff"><b>'Centroid'</b></font>, <font color="#ff40ff"><b>'PixelIdxList'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>250 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;regions_centroids = {regions_properties.Centroid}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>251 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distances = cellfun(@(x) norm(x <font color="#0000ff">-</font>&nbsp;channel_centroid), regions_centroids)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>252 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mean_distance = <font color="#0000ff">mean</font>(distances)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>253 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;d = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(distances)<br>
<font color="#0000ff"><b>254 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;distances(d) <font color="#0000ff">&gt;</font>&nbsp;mean_distance <font color="#0000ff">*</font>&nbsp;distance_proportion_threshold<br>
<font color="#0000ff"><b>255 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx = regions_properties(d).PixelIdxList<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>256 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(idx) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>257 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>258 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>259 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>260 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>261 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>262 </b></font><br>
<font color="#0000ff"><b>263 </b></font><br>
<font color="#0000ff"><b>264 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% we know that the robots are all about the same size - we can thus remove any</b></font></span><br>
<font color="#0000ff"><b>265 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% channels in the mask that have a much smaller area than the other channels</b></font></span><br>
<font color="#0000ff"><b>266 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% this catches some problems like the shadow of the blue robot in </b></font></span><br>
<font color="#0000ff"><b>267 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% data/1/00000095.jpg being detected as a red blob</b></font></span><br>
<font color="#0000ff"><b>268 </b></font><font color="#000000">function</font>&nbsp;image = enforce_similar_channel_areas(image, area_proportion_threshold)<br>
<font color="#0000ff"><b>269 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
<font color="#0000ff"><b>270 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;area_proportion_threshold = <span style="background-color: #ffffff"><font color="#ff6060"><b>0.5</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>271 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>272 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font><font color="#0000ff">~</font>, <font color="#0000ff">~</font>, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>273 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;areas = <font color="#0000ff">zeros</font>(num_channels, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>274 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>275 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>276 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>any(channel(:))<br>
<font color="#0000ff"><b>277 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>278 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>279 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_props = regionprops(channel, <font color="#ff40ff"><b>'Area'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>280 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;areas(c) = region_props.Area<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>281 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>282 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;max_area = <font color="#0000ff">max</font>(areas(areas <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>283 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>284 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;area = areas(c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>285 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;area <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>286 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>287 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>288 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;&nbsp;(area <font color="#0000ff">&lt;</font>&nbsp;max_area <font color="#0000ff">*</font>&nbsp;area_proportion_threshold) <font color="#0000ff">||</font>&nbsp;<font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>289 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(area <font color="#0000ff">&gt;</font>&nbsp;max_area <font color="#0000ff">/</font>&nbsp;area_proportion_threshold)<br>
<font color="#0000ff"><b>290 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = image(:,:,c) <font color="#0000ff">*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>291 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>292 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>293 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>294 </b></font><br>
<font color="#0000ff"><b>295 </b></font><br>
<font color="#0000ff"><b>296 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% this filters out all conneceted regions but the biggest one</b></font></span><br>
<font color="#0000ff"><b>297 </b></font><font color="#000000">function</font>&nbsp;mask = filter_mask(mask)<br>
<font color="#0000ff"><b>298 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>x, y, num_channels<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(mask)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>299 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>300 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">zeros</font>(x, y)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>301 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">reshape</font>(channel, x <font color="#0000ff">*</font>&nbsp;y, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>302 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob_info = bwconncomp(mask(:,:,c))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>303 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob_list = blob_info.PixelIdxList<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>304 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>nrows, ncols<font color="#000000">]</font>&nbsp;= cellfun(@<font color="#0000ff">size</font>, blob_list)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>305 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;largest_blob_pixels = blob_list{find(nrows <font color="#0000ff">==</font>&nbsp;<font color="#0000ff">max</font>(nrows))}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>306 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;i = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: <font color="#0000ff">max</font>(nrows)<br>
<font color="#0000ff"><b>307 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(largest_blob_pixels(i)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>308 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>309 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = <font color="#0000ff">reshape</font>(channel, x, y)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>310 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>311 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>312 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>313 </b></font><br>
<font color="#0000ff"><b>314 </b></font><br>
<font color="#0000ff"><b>315 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% normalises the values of the red, green, and blue channels of |image| in order</b></font></span><br>
<font color="#0000ff"><b>316 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% to eliminate illumination differences in the image</b></font></span><br>
<font color="#0000ff"><b>317 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% formula used: {r, g, b} = {r, g, b} / sqrt(r^2 + g^2 + b^2)</b></font></span><br>
<font color="#0000ff"><b>318 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% if 'approximate' is passed as an additional parameter, instead use</b></font></span><br>
<font color="#0000ff"><b>319 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% {r, g, b} = {r, g, b} / (r + g + b) </b></font></span><br>
<font color="#0000ff"><b>320 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% this is approximately two times faster than the exact normalisation</b></font></span><br>
<font color="#0000ff"><b>321 </b></font><font color="#000000">function</font>&nbsp;normalised_image = normalise_rgb(image, varargin)<br>
<font color="#0000ff"><b>322 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;approximate = <font color="#0000ff">~</font>isempty(find(strcmpi(varargin, <font color="#ff40ff"><b>'approximate'</b></font>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>323 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>324 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>325 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue = double(image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>326 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;approximate<br>
<font color="#0000ff"><b>327 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = red(:,:) <font color="#0000ff">+</font>&nbsp;green(:,:) <font color="#0000ff">+</font>&nbsp;blue(:,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>328 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
<font color="#0000ff"><b>329 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;euclid_rgb = <font color="#0000ff">sqrt</font>(red(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;green(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;blue(:,:)<font color="#0000ff">.^</font><span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>330 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>331 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red_norm = <font color="#0000ff">round</font>(red(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>332 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green_norm = <font color="#0000ff">round</font>(green(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>333 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = <font color="#0000ff">round</font>(blue(:,:) <font color="#0000ff">./</font>&nbsp;euclid_rgb <font color="#0000ff">.*</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>334 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% some pixels are absolute black (r = g = b = 0) which causes division by</b></font></span><br>
<font color="#0000ff"><b>335 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% zero errors during normalisation and NaN values in the normalised channels</b></font></span><br>
<font color="#0000ff"><b>336 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% need to filter these values out</b></font></span><br>
<font color="#0000ff"><b>337 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red_norm(isnan(red_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>338 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green_norm(isnan(green_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>339 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue_norm(isnan(blue_norm)) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>340 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;red_norm = uint8(red_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>341 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;green_norm = uint8(green_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>342 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;blue_norm = uint8(blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>343 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;normalised_image = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, red_norm, green_norm, blue_norm)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>344 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>345 </b></font><br>
<font color="#0000ff"><b>346 </b></font><br>
<font color="#0000ff"><b>347 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% returns image with a cross centered on pixel (|x|, |y|) drawn in |channel|</b></font></span><br>
<font color="#0000ff"><b>348 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% [0, 0] is the top left corner of the image</b></font></span><br>
<font color="#0000ff"><b>349 </b></font><font color="#000000">function</font>&nbsp;image = overlay_cross(image, channel, x, y)<br>
<font color="#0000ff"><b>350 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>h w <font color="#0000ff">~</font><font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>351 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>352 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
<font color="#0000ff"><b>353 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>354 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>355 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>356 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><br>
<font color="#0000ff"><b>357 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>358 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>359 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>360 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;channel <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
<font color="#0000ff"><b>361 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; other1 = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>362 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; other2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>363 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>364 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>365 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&lt;</font>&nbsp;h <br>
<font color="#0000ff"><b>366 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>367 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>368 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>369 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>370 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>371 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<br>
<font color="#0000ff"><b>372 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>373 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>374 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x, y <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>375 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>376 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>377 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&lt;</font>&nbsp;w<br>
<font color="#0000ff"><b>378 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>379 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>380 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>381 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font>&nbsp;&nbsp; <br>
<font color="#0000ff"><b>382 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>383 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><br>
<font color="#0000ff"><b>384 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>385 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>386 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(x <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>387 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>388 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>389 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, channel) = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>390 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, other1) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>391 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;image(x, y, other2) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>392 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>393 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>394 </b></font><br>
<font color="#0000ff"><b>395 </b></font><br>
<font color="#0000ff"><b>396 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% returns the result of putting |mask| onto |image|</b></font></span><br>
<font color="#0000ff"><b>397 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% for each pixel that is set in some channel of |mask|, saturates the pixel in</b></font></span><br>
<font color="#0000ff"><b>398 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% the equivalent channel of |image|</b></font></span><br>
<font color="#0000ff"><b>399 </b></font><font color="#000000">function</font>&nbsp;image = overlay_mask(image, mask, varargin)<br>
<font color="#0000ff"><b>400 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
<font color="#0000ff"><b>401 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;argc = <font color="#0000ff">size</font>(varargin, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>402 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>403 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
<font color="#0000ff"><b>404 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>405 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'GrayScale'</b></font>)<br>
<font color="#0000ff"><b>406 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grayscale = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>407 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Saturation'</b></font>)<br>
<font color="#0000ff"><b>408 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
<font color="#0000ff"><b>409 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Saturation option should be followed by a double'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>410 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>411 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saturation = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>412 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>413 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">elseif</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Lightness'</b></font>)<br>
<font color="#0000ff"><b>414 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
<font color="#0000ff"><b>415 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Lightness option should be followed by a double'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>416 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>417 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lightness = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>418 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>419 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>420 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>421 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>422 </b></font><br>
<font color="#0000ff"><b>423 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% modify background image</b></font></span><br>
<font color="#0000ff"><b>424 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'grayscale'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
<font color="#0000ff"><b>425 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gray_image = rgb2gray(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>426 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = cat(<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>, gray_image, gray_image, gray_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>427 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>428 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'saturation'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
<font color="#0000ff"><b>429 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image = rgb2hsv(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>430 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) = hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>) <font color="#0000ff">*</font>&nbsp;saturation<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>431 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = hsv2rgb(hsv_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>432 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>433 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;exist(<font color="#ff40ff"><b>'lightness'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
<font color="#0000ff"><b>434 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image = rgb2hsv(image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>435 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) = hsv_image(:,:,<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>) <font color="#0000ff">*</font>&nbsp;lightness<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>436 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = hsv2rgb(hsv_image)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>437 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>438 </b></font><br>
<font color="#0000ff"><b>439 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% lay mask onto background image</b></font></span><br>
<font color="#0000ff"><b>440 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;num_channels = <font color="#0000ff">size</font>(image, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>441 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;channels = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>442 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>443 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>444 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask_pixels = find(mask(:,:,c) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>445 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(mask_pixels) = <span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>446 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>447 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;d = setdiff(channels, c)<br>
<font color="#0000ff"><b>448 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,d)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>449 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(mask_pixels) = <span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>450 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,d) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>451 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>452 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>453 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>454 </b></font><br>
<font color="#0000ff"><b>455 </b></font><br>
<font color="#0000ff"><b>456 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% returns image with lines drawn from the nth point in |points| to the n+1th</b></font></span><br>
<font color="#0000ff"><b>457 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% [0, 0] is the top left corner of the image</b></font></span><br>
<font color="#0000ff"><b>458 </b></font><font color="#000000">function</font>&nbsp;image = overlay_polygon(image, points, color)<br>
<font color="#0000ff"><b>459 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;nargin <font color="#0000ff">&lt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span><br>
<font color="#0000ff"><b>460 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color = <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>461 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>462 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<font color="#0000ff"><b>463 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;points = <font color="#0000ff">round</font>(points)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>464 </b></font><br>
<font color="#0000ff"><b>465 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;num_channels = <font color="#0000ff">size</font>(image, <span style="background-color: #ffffff"><font color="#ff6060"><b>3</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>466 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_channels<br>
<font color="#0000ff"><b>467 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = image(:,:,c)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>468 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel = overlay_polygon_channel(channel, points, color(c))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>469 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image(:,:,c) = channel<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>470 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>471 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>472 </b></font><br>
<font color="#0000ff"><b>473 </b></font><br>
<font color="#0000ff"><b>474 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% Bresenham's line algorithm (simplified version)</b></font></span><br>
<font color="#0000ff"><b>475 </b></font><span style="background-color: #ffffff"><font color="#808080"><b>% <a href="http://en.wikipedia.org/wiki/Bresenham">http://en.wikipedia.org/wiki/Bresenham</a>'s_line_algorithm#Simplification</b></font></span><br>
<font color="#0000ff"><b>476 </b></font><font color="#000000">function</font>&nbsp;channel = overlay_polygon_channel(channel, points, color)<br>
<font color="#0000ff"><b>477 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">[</font>xmax, ymax<font color="#000000">]</font>&nbsp;= <font color="#0000ff">size</font>(channel)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>478 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: length(points) <font color="#0000ff">-</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
<font color="#0000ff"><b>479 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start = points(c,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>480 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop = points(c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>,:)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>481 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = start(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>482 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = start(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>483 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x1 = stop(<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>484 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 = stop(<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>485 </b></font><br>
<font color="#0000ff"><b>486 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx = <font color="#0000ff">abs</font>(x1 <font color="#0000ff">-</font>&nbsp;x0)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>487 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dy = <font color="#0000ff">abs</font>(y1 <font color="#0000ff">-</font>&nbsp;y0)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>488 </b></font><br>
<font color="#0000ff"><b>489 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">&lt;</font>&nbsp;x1<br>
<font color="#0000ff"><b>490 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sx = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>491 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
<font color="#0000ff"><b>492 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sx = <font color="#0000ff">-</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>493 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>494 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;y0 <font color="#0000ff">&lt;</font>&nbsp;y1<br>
<font color="#0000ff"><b>495 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sy = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>496 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">else</font><br>
<font color="#0000ff"><b>497 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sy = <font color="#0000ff">-</font><span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>498 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>499 </b></font><br>
<font color="#0000ff"><b>500 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = dx <font color="#0000ff">-</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>501 </b></font><br>
<font color="#0000ff"><b>502 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><br>
<font color="#0000ff"><b>503 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;x0 <font color="#0000ff">&lt;=</font>&nbsp;xmax <font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">&gt;</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>0</b></font></span>&nbsp;<font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">&lt;=</font>&nbsp;ymax<br>
<font color="#0000ff"><b>504 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel(x0, y0) = color<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>505 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>506 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;x0 <font color="#0000ff">==</font>&nbsp;x1 <font color="#0000ff">&amp;&amp;</font>&nbsp;y0 <font color="#0000ff">==</font>&nbsp;y1<br>
<font color="#0000ff"><b>507 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">break</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>508 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>509 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e2 = <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">*</font>&nbsp;err<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>510 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;e2 <font color="#0000ff">&gt;</font>&nbsp;<font color="#0000ff">-</font>dy<br>
<font color="#0000ff"><b>511 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = err <font color="#0000ff">-</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>512 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = x0 <font color="#0000ff">+</font>&nbsp;sx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>513 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>514 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;e2 <font color="#0000ff">&lt;</font>&nbsp;dx<br>
<font color="#0000ff"><b>515 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = err <font color="#0000ff">+</font>&nbsp;dx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>516 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = y0 <font color="#0000ff">+</font>&nbsp;sy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>517 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>518 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>519 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>520 </b></font><font color="#0000ff">end</font><br>
<font color="#0000ff"><b>521 </b></font><br>
<font color="#0000ff"><b>522 </b></font><br>
<font color="#0000ff"><b>523 </b></font><font color="#000000">function</font>&nbsp;image = overlay_rays(image, from, to, length, varargin)<br>
<font color="#0000ff"><b>524 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% parse options</b></font></span><br>
<font color="#0000ff"><b>525 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;argc = <font color="#0000ff">size</font>(varargin, <span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>526 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>527 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">while</font>&nbsp;c <font color="#0000ff">&lt;=</font>&nbsp;argc<br>
<font color="#0000ff"><b>528 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg = varargin{c}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>529 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;strcmpi(arg, <font color="#ff40ff"><b>'Color'</b></font>)<br>
<font color="#0000ff"><b>530 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;<font color="#0000ff">&gt;</font>&nbsp;argc<br>
<font color="#0000ff"><b>531 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">error</font>(<font color="#ff40ff"><b>'Color option should be followed by an integer tripplet'</b></font>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>532 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>533 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = varargin{c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>}<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>534 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>535 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>536 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c = c <font color="#0000ff">+</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>537 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>538 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #ffffff"><font color="#808080"><b>% option defaults</b></font></span><br>
<font color="#0000ff"><b>539 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">~</font>exist(<font color="#ff40ff"><b>'colors'</b></font>, <font color="#ff40ff"><b>'var'</b></font>)<br>
<font color="#0000ff"><b>540 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = <font color="#000000">[</font><span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>255</b></font></span><font color="#000000">]</font><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>541 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>542 </b></font><br>
<font color="#0000ff"><b>543 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;num_rays = <font color="#0000ff">size</font>(from, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>544 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;<font color="#0000ff">size</font>(colors, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>) <font color="#0000ff">==</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span><span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>545 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colors = repmat(colors, num_rays, <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>546 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>547 </b></font><br>
<font color="#0000ff"><b>548 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">for</font>&nbsp;c = <span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>&nbsp;: num_rays<br>
<font color="#0000ff"><b>549 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font>&nbsp;from(c,:) <font color="#0000ff">==</font>&nbsp;to(c,:)<br>
<font color="#0000ff"><b>550 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>551 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>552 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x0 = from(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>553 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y0 = from(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>554 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x1 = to(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>1</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>555 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1 = to(c,<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>556 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dx = x0 <font color="#0000ff">-</font>&nbsp;x1<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>557 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dy = y0 <font color="#0000ff">-</font>&nbsp;y1<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>558 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lambda = <font color="#0000ff">min</font>(<font color="#0000ff">sqrt</font>(length <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(dx <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;dy <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)), <font color="#ff6060"><b>...</b></font><br>
<font color="#0000ff"><b>559 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">-</font><font color="#0000ff">sqrt</font>(length <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">/</font>&nbsp;(dx <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>&nbsp;<font color="#0000ff">+</font>&nbsp;dy <font color="#0000ff">^</font>&nbsp;<span style="background-color: #ffffff"><font color="#ff6060"><b>2</b></font></span>)))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>560 </b></font><br>
<font color="#0000ff"><b>561 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = x0 <font color="#0000ff">+</font>&nbsp;lambda <font color="#0000ff">*</font>&nbsp;dx<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>562 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y = y0 <font color="#0000ff">+</font>&nbsp;lambda <font color="#0000ff">*</font>&nbsp;dy<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>563 </b></font><br>
<font color="#0000ff"><b>564 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image = overlay_polygon(image, <font color="#000000">[</font>x0 y0<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span>&nbsp;x y<font color="#000000">]</font>, colors(c,:))<span style="background-color: #ffffff"><font color="#808080"><b>;</b></font></span><br>
<font color="#0000ff"><b>565 </b></font>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">end</font><br>
<font color="#0000ff"><b>566 </b></font><font color="#0000ff">end</font><br>
</font></body>
</html>
